{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/i5-10400f/Desktop/social-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/i5-10400f/Desktop/social-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/i5-10400f/Desktop/social-react/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect,useContext}from'react';import{UserContext}from'../Context/userContext';import{doc,query,getDocs,collection,deleteDoc,updateDoc}from\"firebase/firestore\";import SkeletonWrapper from'../Skeleton/SkeletonWrapper';import Comment from'../AddComment/Comment';import{db}from'../firebase/firebase';import\"./Post.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Post=function Post(){var _useContext$user=_slicedToArray(useContext(UserContext).user,2),user=_useContext$user[0],setUser=_useContext$user[1];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),docs=_useState2[0],setDocs=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),comment=_useState4[0],setComment=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),commentsArray=_useState6[0],setCommentsArray=_useState6[1];var q=query(collection(db,\"posts\"));var handleDeletePost=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return deleteDoc(doc(db,\"posts\",id));case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleDeletePost(_x){return _ref.apply(this,arguments);};}();var handleAddComment=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var commentsRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:commentsArray.push({username:user.displayName,comment:comment});commentsRef=doc(db,\"posts\",id);_context2.next=4;return updateDoc(commentsRef,{comments:commentsArray},{merge:true});case 4:setComment('');case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleAddComment(_x2){return _ref2.apply(this,arguments);};}();useEffect(function(){setTimeout(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var querySnapshot;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getDocs(q);case 2:querySnapshot=_context3.sent;setDocs(querySnapshot.docs.map(function(doc){return{id:doc.id,post:doc.data()};}));case 4:case\"end\":return _context3.stop();}}},_callee3);})),2000);},[q]);return/*#__PURE__*/_jsxs(\"div\",{children:[docs.length==0&&/*#__PURE__*/_jsxs(_Fragment,{children:[\" \",/*#__PURE__*/_jsx(SkeletonWrapper,{}),\" \",/*#__PURE__*/_jsx(SkeletonWrapper,{}),\" \"]}),docs.length>1&&docs.map(function(_ref4){var id=_ref4.id,post=_ref4.post;return/*#__PURE__*/_jsxs(\"div\",{className:\"post\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-header\",children:[/*#__PURE__*/_jsx(\"img\",{src:post.profileUrl,alt:\"profileUrl\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"username\",children:post.username}),user&&user.displayName===post.username&&/*#__PURE__*/_jsx(\"button\",{className:\"delete-post\",onClick:function onClick(){return handleDeletePost(id);},children:\"Delete\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"post-image\",children:/*#__PURE__*/_jsx(\"img\",{src:post.photoUrl,alt:post.username})}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-caption\",children:[/*#__PURE__*/_jsx(\"span\",{children:post.username}),/*#__PURE__*/_jsx(\"p\",{children:post.post})]}),post.comments&&post.comments.map(function(comment){return/*#__PURE__*/_jsxs(\"div\",{className:\"post-comments\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"username-comment\",children:comment.username}),/*#__PURE__*/_jsx(\"p\",{className:\"comment\",children:comment.comment})]});}),user&&/*#__PURE__*/_jsx(Comment,{comment:comment,setComment:setComment,handleAddComment:handleAddComment,id:id})]},id);})]});};export default Post;","map":{"version":3,"sources":["C:/Users/i5-10400f/Desktop/social-react/src/components/Post/Post.js"],"names":["React","useState","useEffect","useContext","UserContext","doc","query","getDocs","collection","deleteDoc","updateDoc","SkeletonWrapper","Comment","db","Post","user","setUser","docs","setDocs","comment","setComment","commentsArray","setCommentsArray","q","handleDeletePost","id","handleAddComment","push","username","displayName","commentsRef","comments","merge","setTimeout","querySnapshot","map","post","data","length","profileUrl","photoUrl"],"mappings":"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","sourcesContent":["import React,{useState, useEffect, useContext} from 'react'\r\nimport { UserContext } from '../Context/userContext';\r\nimport { doc, query, getDocs, collection, deleteDoc, updateDoc  } from \"firebase/firestore\";\r\nimport SkeletonWrapper from '../Skeleton/SkeletonWrapper'\r\nimport Comment from '../AddComment/Comment'\r\nimport {db} from '../firebase/firebase'\r\n\r\nimport \"./Post.css\"\r\n\r\nconst Post = () => {\r\n    const [user, setUser] = useContext(UserContext).user;\r\n    const [docs, setDocs] = useState([]);\r\n    const [comment, setComment] = useState(null)\r\n    const [commentsArray, setCommentsArray] = useState([]);\r\n    const q = query(collection(db, \"posts\"));\r\n\r\n    const handleDeletePost = async (id) => {\r\n        await deleteDoc(doc(db, \"posts\", id));\r\n      }\r\n      \r\n      const handleAddComment = async (id) => {\r\n        commentsArray.push({\r\n          username: user.displayName,\r\n          comment: comment,\r\n        })\r\n        const commentsRef = doc(db, \"posts\", id);\r\n        await updateDoc(commentsRef, {\r\n          comments: commentsArray\r\n        },{ merge: true });\r\n        setComment('')\r\n  \r\n      }\r\n\r\n    useEffect( () => {\r\n        setTimeout(async () => {\r\n          const querySnapshot = await getDocs(q);\r\n          setDocs(querySnapshot.docs.map(doc => ( {id: doc.id, post: doc.data() } )));\r\n        },2000)\r\n      }, [q])\r\n      \r\n    return (\r\n        <div>\r\n          { docs.length == 0 && <> <SkeletonWrapper /> <SkeletonWrapper /> </>}\r\n            { docs.length > 1 && docs.map( ({id, post}) => (\r\n            <div className=\"post\" key={id}>\r\n            <div className=\"post-header\">\r\n                <img src={post.profileUrl} alt=\"profileUrl\" />\r\n                <h3 className='username'>{post.username}</h3>\r\n                { user && user.displayName === post.username && <button className='delete-post' onClick={() => handleDeletePost(id)}>Delete</button>}\r\n            </div>\r\n            <div className=\"post-image\">\r\n                <img src={post.photoUrl} alt={post.username} />\r\n            </div>\r\n            \r\n            <div className=\"post-caption\">\r\n                <span>{post.username}</span>\r\n                <p>{post.post}</p>\r\n            </div>\r\n            { post.comments && post.comments.map(comment => (\r\n                <div className=\"post-comments\">\r\n                <p className=\"username-comment\">{comment.username}</p>\r\n                <p className=\"comment\">{comment.comment}</p>\r\n                </div>\r\n            ))}\r\n            {user && <Comment comment={comment} setComment={setComment} handleAddComment={handleAddComment} id={id} />}\r\n            </div>\r\n        ) ) }\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Post\r\n"]},"metadata":{},"sourceType":"module"}