{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/i5-10400f/Desktop/react-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/i5-10400f/Desktop/react-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/i5-10400f/Desktop/react-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useState}from'react';import{UserContext}from'../Context/userContext';import{db}from'../firebase/firebase';import{doc,query,getDocs,collection,deleteDoc,updateDoc}from\"firebase/firestore\";import Comment from'../AddComment/Comment';import'./AllPosts.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AllPosts=function AllPosts(){// Variabels\nvar _useContext$user=_slicedToArray(useContext(UserContext).user,2),user=_useContext$user[0],setUser=_useContext$user[1];var _useState=useState([]),_useState2=_slicedToArray(_useState,2),docs=_useState2[0],setDocs=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),comment=_useState4[0],setComment=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),commentsArray=_useState6[0],setCommentsArray=_useState6[1];var q=query(collection(db,\"posts\"));// Functions\nvar handleDeletePost=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return deleteDoc(doc(db,\"posts\",id));case 2:case\"end\":return _context.stop();}}},_callee);}));return function handleDeletePost(_x){return _ref.apply(this,arguments);};}();var handleAddComment=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id){var commentsRef;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:commentsArray.push({username:user.displayName,comment:comment});commentsRef=doc(db,\"posts\",id);_context2.next=4;return updateDoc(commentsRef,{comments:commentsArray},{merge:true});case 4:setComment('');case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function handleAddComment(_x2){return _ref2.apply(this,arguments);};}();useEffect(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var querySnapshot;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return getDocs(q);case 2:querySnapshot=_context3.sent;setDocs(querySnapshot.docs.map(function(doc){return{id:doc.id,post:doc.data()};}));case 4:case\"end\":return _context3.stop();}}},_callee3);})),[q]);return/*#__PURE__*/_jsx(\"div\",{className:\"posts\",children:docs.length>0?/*#__PURE__*/_jsx(_Fragment,{children:docs.map(function(_ref4){var id=_ref4.id,post=_ref4.post;return/*#__PURE__*/_jsxs(\"div\",{className:\"post\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"post-header\",children:[/*#__PURE__*/_jsx(\"img\",{src:post.profileUrl,alt:\"profileUrl\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"username\",children:post.username}),user&&user.displayName===post.username&&/*#__PURE__*/_jsx(\"button\",{className:\"delete-post\",onClick:function onClick(){return handleDeletePost(id);},children:\"Delete\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"post-image\",children:/*#__PURE__*/_jsx(\"img\",{src:post.photoUrl,alt:post.username})}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-caption\",children:[/*#__PURE__*/_jsx(\"span\",{children:post.username}),/*#__PURE__*/_jsx(\"p\",{children:post.post})]}),post.comments&&post.comments.map(function(comment){return/*#__PURE__*/_jsxs(\"div\",{className:\"post-comments\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"username-comment\",children:comment.username}),/*#__PURE__*/_jsx(\"p\",{className:\"comment\",children:comment.comment})]});}),user&&/*#__PURE__*/_jsx(Comment,{comment:comment,setComment:setComment,handleAddComment:handleAddComment,id:id})]},id);})}):/*#__PURE__*/_jsxs(\"div\",{className:\"posts\",children:[\" \",/*#__PURE__*/_jsx(\"p\",{children:\"No posts yet , Start adding some \\uD83D\\uDCDD ...\"}),\" \"]})});};export default AllPosts;","map":{"version":3,"sources":["C:/Users/i5-10400f/Desktop/react-test/src/components/AllPosts/AllPosts.js"],"names":["React","useContext","useEffect","useState","UserContext","db","doc","query","getDocs","collection","deleteDoc","updateDoc","Comment","AllPosts","user","setUser","docs","setDocs","comment","setComment","commentsArray","setCommentsArray","q","handleDeletePost","id","handleAddComment","push","username","displayName","commentsRef","comments","merge","querySnapshot","map","post","data","length","profileUrl","photoUrl"],"mappings":"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","sourcesContent":["import React, {useContext, useEffect, useState} from 'react'\r\nimport {UserContext} from '../Context/userContext'\r\nimport {db} from '../firebase/firebase'\r\nimport { doc, query, getDocs, collection, deleteDoc, updateDoc  } from \"firebase/firestore\";\r\nimport Comment from '../AddComment/Comment'\r\nimport './AllPosts.css'\r\n\r\n\r\n\r\nconst AllPosts = () => {\r\n  // Variabels\r\n\r\n    const [user, setUser] = useContext(UserContext).user;\r\n    const [docs, setDocs] = useState([]);\r\n    const [comment, setComment] = useState(null)\r\n    const [commentsArray, setCommentsArray] = useState([]);\r\n    const q = query(collection(db, \"posts\"));\r\n\r\n\r\n    // Functions\r\n\r\n    const handleDeletePost = async (id) => {\r\n      await deleteDoc(doc(db, \"posts\", id));\r\n    }\r\n    const handleAddComment = async (id) => {\r\n      commentsArray.push({\r\n        username: user.displayName,\r\n        comment: comment,\r\n      })\r\n      const commentsRef = doc(db, \"posts\", id);\r\n      await updateDoc(commentsRef, {\r\n        comments: commentsArray\r\n      },{ merge: true });\r\n      setComment('')\r\n\r\n    }\r\n\r\n    useEffect(async () => {\r\n      const querySnapshot = await getDocs(q);\r\n      setDocs(querySnapshot.docs.map(doc => ( {id: doc.id, post: doc.data() } )));\r\n    }, [q])\r\n    return (  \r\n\r\n      <div className=\"posts\">\r\n        {docs.length > 0 ? (\r\n          <>\r\n          { docs.map( ({id, post}) => (\r\n          <div className=\"post\" key={id}>\r\n            <div className=\"post-header\">\r\n              <img src={post.profileUrl} alt=\"profileUrl\" />\r\n              <h3 className='username'>{post.username}</h3>\r\n              { user && user.displayName === post.username && <button className='delete-post' onClick={() => handleDeletePost(id)}>Delete</button>}\r\n            </div>\r\n            <div className=\"post-image\">\r\n              <img src={post.photoUrl} alt={post.username} />\r\n            </div>\r\n          \r\n            <div className=\"post-caption\">\r\n              <span>{post.username}</span>\r\n              <p>{post.post}</p>\r\n            </div>\r\n            { post.comments && post.comments.map(comment => (\r\n              <div className=\"post-comments\">\r\n                <p className=\"username-comment\">{comment.username}</p>\r\n                <p className=\"comment\">{comment.comment}</p>\r\n              </div>\r\n            ))}\r\n            {user && <Comment comment={comment} setComment={setComment} handleAddComment={handleAddComment} id={id} />}\r\n          </div>\r\n        ) ) }\r\n          </>\r\n        ) : <div className=\"posts\"> <p>No posts yet , Start adding some üìù ...</p> </div> }\r\n      </div>\r\n    )}\r\n\r\nexport default AllPosts\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}