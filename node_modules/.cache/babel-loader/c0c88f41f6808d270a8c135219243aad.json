{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/i5-10400f/Desktop/react-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/i5-10400f/Desktop/react-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/i5-10400f/Desktop/react-test/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useState}from\"react\";import{UserContext}from\"../Context/userContext\";import{db,storage}from\"../firebase/firebase\";import{ref,uploadBytesResumable,getDownloadURL}from\"firebase/storage\";import{doc,setDoc}from\"firebase/firestore\";import\"./CreatePost.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreatePost=function CreatePost(){var _useContext$user=_slicedToArray(useContext(UserContext).user,2),user=_useContext$user[0],setUser=_useContext$user[1];var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),image=_useState4[0],setImage=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),myprogress=_useState6[0],setMyprogress=_useState6[1];var generateId=function generateId(length){var allCarc=\"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\";var myId='';for(var i=0;i<length;i++){myId+=allCarc[Math.floor(Math.random()*allCarc.length)];}return myId;};var handleUpload=function handleUpload(){if(image){var imageName=generateId(10);var imagesRef=ref(storage,\"images/\".concat(imageName,\".jpg\"));var metadata={contentType:'image/jpeg'};var uploadTask=uploadBytesResumable(imagesRef,image,metadata);uploadTask.on('state_complete',function(snapshot){var progress=Math.round(snapshot.bytesTransferred/snapshot.totalBytes*100);setMyprogress(progress);console.log('Upload is '+progress+'% done');if(progress==100){setPost(\"\");setMyprogress(0);var myImageTag=document.getElementById('Image-Preview');myImageTag.style.display='none';}},function(error){console.log(error);},function(){getDownloadURL(imagesRef).then(/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(imageURL){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return setDoc(doc(db,\"posts\",imageName),{post:post,profileUrl:user.photoURL,username:user.displayName,photoUrl:imageURL});case 3:_context.next=8;break;case 5:_context.prev=5;_context.t0=_context[\"catch\"](0);console.error(\"Error adding document: \",_context.t0);case 8:case\"end\":return _context.stop();}}},_callee,null,[[0,5]]);}));return function(_x){return _ref.apply(this,arguments);};}());});}};var handleImage=function handleImage(e){if(e.target.files[0]){setImage(e.target.files[0]);var urlObject=URL.createObjectURL(e.target.files[0]);var myImageTag=document.getElementById('Image-Preview');myImageTag.src=urlObject;myImageTag.style.display='block';myImageTag.style.width='100px';myImageTag.style.height='100px';myImageTag.style.padding='10px';}};return/*#__PURE__*/_jsxs(\"div\",{id:\"override-bootstrap\",className:\"create-post\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"img\",{src:user.photoURL,alt:\"\",className:\"create-post-user-image\"})}),/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Whats On Your Mind?\",value:post,onChange:function onChange(e){return setPost(e.target.value);}}),/*#__PURE__*/_jsx(\"div\",{className:\"image\",children:/*#__PURE__*/_jsx(\"img\",{alt:\"img\",id:\"Image-Preview\"})}),/*#__PURE__*/_jsxs(\"div\",{className:\"actions\",children:[/*#__PURE__*/_jsx(\"label\",{required:true,htmlFor:\"addImage\",style:{cursor:\"pointer\"},children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-camera\"})}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"addImage\",accept:\"image/*\",style:{display:\"none\"},onChange:handleImage}),/*#__PURE__*/_jsx(\"button\",{onClick:handleUpload,style:{color:post||image||myprogress>1?'black':'#999'},children:\"Post \".concat(myprogress>1?myprogress+'%':\"\")})]})]});};export default CreatePost;","map":{"version":3,"sources":["C:/Users/i5-10400f/Desktop/react-test/src/components/CreatePost/CreatePost.js"],"names":["React","useContext","useState","UserContext","db","storage","ref","uploadBytesResumable","getDownloadURL","doc","setDoc","CreatePost","user","setUser","post","setPost","image","setImage","myprogress","setMyprogress","generateId","length","allCarc","myId","i","Math","floor","random","handleUpload","imageName","imagesRef","metadata","contentType","uploadTask","on","snapshot","progress","round","bytesTransferred","totalBytes","console","log","myImageTag","document","getElementById","style","display","error","then","imageURL","profileUrl","photoURL","username","displayName","photoUrl","handleImage","e","target","files","urlObject","URL","createObjectURL","src","width","height","padding","value","cursor","color"],"mappings":"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","sourcesContent":["import React, { useContext, useState } from \"react\";\r\nimport { UserContext } from \"../Context/userContext\";\r\nimport { db, storage } from \"../firebase/firebase\";\r\nimport {ref, uploadBytesResumable, getDownloadURL } from \"firebase/storage\";\r\nimport { doc, setDoc } from \"firebase/firestore\"; \r\n\r\n\r\nimport \"./CreatePost.css\"\r\nconst CreatePost = () => {\r\n\r\n\r\n  const [user, setUser] = useContext(UserContext).user;\r\n  const [post, setPost] = useState(\"\");\r\n  const [image, setImage] = useState(null);\r\n  const [myprogress, setMyprogress] = useState(null);\r\n\r\n\r\n  const generateId = (length) => {\r\n    let allCarc = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890\";\r\n    let myId = '';\r\n    for (var i = 0; i < length ; i++){\r\n        myId += allCarc[Math.floor(Math.random() * allCarc.length)] \r\n    }\r\n    return myId\r\n  }\r\n\r\n\r\n  const handleUpload = () => {\r\n    if(image){\r\n      const imageName = generateId(10);\r\n      const imagesRef = ref(storage, `images/${imageName}.jpg`);\r\n      const metadata = {\r\n        contentType: 'image/jpeg',\r\n      };\r\n      const uploadTask = uploadBytesResumable(imagesRef,image,metadata);\r\n\r\n      \r\n\r\n    uploadTask.on('state_complete',(snapshot) => {\r\n      const progress = Math.round((snapshot.bytesTransferred / snapshot.totalBytes) * 100);\r\n      setMyprogress(progress)\r\n      console.log('Upload is ' + progress + '% done');\r\n      if(progress == 100) {\r\n        setPost(\"\")\r\n        setMyprogress(0)\r\n        var myImageTag = document.getElementById('Image-Preview')\r\n        myImageTag.style.display = 'none'\r\n      }\r\n    },(error) => {\r\n      console.log(error)\r\n    },() => {\r\n      getDownloadURL(imagesRef).then(async imageURL => {\r\n        try {\r\n          await setDoc(doc(db, \"posts\", imageName), {\r\n            post: post,\r\n            profileUrl: user.photoURL,\r\n            username: user.displayName,\r\n            photoUrl: imageURL,\r\n          });\r\n        } catch (e) {\r\n          console.error(\"Error adding document: \", e);\r\n        }\r\n      })\r\n    })\r\n    }\r\n    \r\n  }\r\n\r\n\r\n  const handleImage = (e) => {\r\n    if(e.target.files[0]){\r\n\r\n      setImage(e.target.files[0])\r\n\r\n      var urlObject = URL.createObjectURL(e.target.files[0])\r\n\r\n      var myImageTag = document.getElementById('Image-Preview')\r\n      myImageTag.src = urlObject\r\n      myImageTag.style.display = 'block'\r\n      myImageTag.style.width = '100px'\r\n      myImageTag.style.height = '100px'\r\n      myImageTag.style.padding = '10px'\r\n    }\r\n  }\r\n\r\n\r\n    return (\r\n        <div id='override-bootstrap' className=\"create-post\">\r\n          <p><img src={user.photoURL} alt=\"\" className='create-post-user-image' /></p>\r\n            <textarea\r\n            placeholder='Whats On Your Mind?'\r\n            value={post}\r\n            onChange={e => setPost(e.target.value)}>\r\n            </textarea>\r\n            <div className=\"image\">\r\n              <img alt=\"img\" id='Image-Preview' />\r\n            </div>\r\n            <div className=\"actions\">\r\n            <label required htmlFor=\"addImage\" style={{cursor:\"pointer\"}}><i className=\"fas fa-camera\"></i></label>\r\n            <input type=\"file\" id='addImage' accept='image/*' style={{display: \"none\"}} onChange={handleImage}/>\r\n            <button onClick={handleUpload} style={{color: post || image || myprogress > 1  ? 'black' : '#999'}}>{`Post ${ myprogress > 1 ? myprogress + '%' : \"\"}`}</button>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default CreatePost;\r\n"]},"metadata":{},"sourceType":"module"}